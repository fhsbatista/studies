Olá pessoal, tudo bem? Eu acho que agora tá começando a ficar um pouco mais claro toda essa história de partições, das keys, dos tópicos aí pra você. Mas o que acontece? Existe muito por trás, vamos dizer, do Kafka de como que ele funciona. Principalmente em relação a essa distribuição E agora a gente vai entender um pouco melhor sobre como tudo isso aí funciona. Então vamos falar um pouquinho aqui sobre partições distribuídas. Vamos lá. Eu tenho um tópico aqui, tópico de vendas. E eu tenho o broker A com a partição 1. Aí o que acontece? Eu tenho o broker B com a partição 2. E eu tenho o broker C com a partição 3. Então, o que acontece? Cada vez que eu mando uma mensagem, uma hora cai em cada broker. Então perceba, cada broker é uma máquina totalmente diferente, mas essas partições ficam separadas. A partição é basicamente um local índice onde ele vai guardar as mensagens. Tem os segmentos das mensagens e elas ficam guardadas ali. Então, o que vai acontecer aqui nesse nosso ponto? assim acontece vamos lá agora vamos imaginar o seguinte vamos imaginar que eu tenho agora essa situação aqui eu vou escolher algo que a gente chama de Replicator Factor e nesse caso estou falando que o Replicator Factor é igual a 2 Wesley, do que você está falando? olha só que interessante agora eu tenho o Broker A com a partição 1 e 3. Agora eu tenho o broker B com a partição 2 e 1. E agora eu tenho o broker C com a partição 3 e 2. Wesley, que loucura é essa? Espera um pouquinho, deixa eu pensar. Olha só que interessante, galera. Da forma anterior como estava, estava tudo ok, a gente tinha aquela distribuição. Mas o problema era, se um broker caísse, a gente ia perder os dados de uma partição. as mensagens iam ser perdidas e lembra a gente tem que garantir resiliência. Então por conta disso no Kafka a gente pode escolher algo que a gente chama de Replicator Factor. O que que isso acontece no final das contas? Quando eu crio um tópico eu falo esse tópico vai ter três partições com Replicator Factor de a Replication Factor na realidade é com um Replication Factor de 2 então eu tô dizendo o seguinte olha você tem três partições porém essas partições elas tem que ter pelo menos duas cópias em cada broker Então o que vai acontecer aí no final das contas é que se um broker cair eu garanto que eu tenho um backup daquela partição que foi embora com aquele broker. Então o Replication Factor aqui ele vai nos ajudar demais em relação a garantir resiliência. por que? porque as partições elas ficam distribuídas mas também a gente consegue colocar cópia mas olha só que interessante já pensou se eu falo o seguinte olha eu vou criar um tópico e esse tópico vai ter por exemplo 10 partições e eu quero replicar mas os meus dados são tão importantes que eu não posso nem pensar em perder então eu quero um replication factor por exemplo de 4 então o que significa? que eu vou ter 10 partições mas nos brokers que eu tiver eu vou ter que ter quatro cópias dessas partições separadas ali para mim. Então a grande sacada é Morreu um broker, não perdi nada. Morreu outro broker, não perdi nada. Morreu outro broker, não perdi nada. Morreu outro... Aí você perdeu. Entende? Então de acordo com o quão mais crítico é a sua aplicação, maior você pode aumentar o Replication Factor. O grande ponto é que quanto maior o Replication Factor, espaço em disco você vai ter mais vai consumir do seu broker e tudo mais então você tem que ser ali mais vamos eu wise né sábio em conseguir normalmente entender o quanto você vai colocar normalmente tá as pessoas que eu conheço que estão ali na linha de batalha com cáfrica normalmente utilizam dois ou três três quando tem muita quando é algo muito crítico. Mas o 2 é o mínimo que você tem que fazer, porque você tem que manter a parada funcionando. Vai depender muito do seu cluster, mas a grande sacada é que se você conseguir garantir a replicação, não tem perigo se um broker ficar down, porque o Kafka vai ter a cópia daquela mensagem em outro broker ali pra gente. Legal? Então isso aí é extremamente importante pra você entender, porque você já começa a pensar na genialidade em toda essa arquitetura do Kafka. Agora eu tenho partições distribuídas, eu consigo fazer mais pessoas lerem, mas para diminuir o risco desses brokers caírem e as mensagens perderem, eu consigo criar cópias dessas mensagens distribuídas em outros brokers para que eu garanta mais resiliência e mesmo assim eu consigo escalar. Mesmo assim, eu consigo garantir resiliência, consigo garantir alta disponibilidade das minhas informações. Top demais, né? Como o Kafka foi feito. Realmente, eu fico apaixonado toda vez que eu falo sobre isso, porque eu acho uma solução realmente genial.