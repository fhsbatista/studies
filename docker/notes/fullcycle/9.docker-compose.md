# Docker compose
É uma maneira declarativa de configurar containers, via yml.

É vantajoso, pois:
 - é uma maneira de documentar os componentes do sistema
 - evita repetição de comandos no terminal
 - maneira fácil de compartilhar um mesmo conjunto de containers, garatindo que sejam configurados sempre da mesma forma.

Essas configurações são feitas no arquivo `docker-compose.yml`.

Obs: `.yml` ou `.yaml`, tanto faz.

## Estrutura do arquivo
### Version
Antigamente era necessário informar a versão do docker-compose usado, pela tag `version`.

Atualmente isso não é mais necessário.

### `services`
É onde declaramos os containers. Cada `service` seria um container.

### `image`
O mínimo necessário no service, é informar a imagem através da tag `image`.

Ex:
```yml
services:
    nginx:
        image: nginx:latest
```

### `ports`

Onde vamos publicar as portas. Equivalente ao parametro `p` ao usar o `docker run`

```yml
services:
    nginx:
        image: nginx:latest
        ports:
         - "1256:80"
```

### `volumes`
Onde vamos configurar "volumes" e "bind mounts"

Estrutura:

`<dir da pasta no host>:<dir da pasta no container>`

```yml
services:
    nginx:
        image: nginx:latest
        volumes:
         - ./nginx-html:/user/share/nginx/html
```

#### Volume vs Bind mount
Para configurar como "bind mount", o diretório da pasta no host deve ter o "./" no início.

Para configurar "volume", é só NÃO usar o "./"

## Comandos
### Rodar containers
`docker compose up`

Esse comando vai criar e iniciar os containers.

Obs: Também será criada uma rede para esses containers, então eles irão conseguir se comunicar entre si.

#### Parametros
 - `d` : "dettached" -> usando esse parâmetro, o terminal não fica preso no log do container.

### Remover container
`docker compose down`

-> Esse vai parar e remover todos os containers do `docker-compose.yml`.

#### Removendo um container específico
Basta usar o comando `down` junto com o nome do container.

Ex:
`docker compose down mongo`


### `docker compose`
Se estamos dentro da pasta raíz do arquivo docker-compose, podemos usar o comando `docker compose` em vez de `docker`. Isso é interessante pois assim não precisamos usar o nome do container diretamente, mas sim o nome do serviço. O que é mais simples pois o nome do container criado pelo docker-compose normalmente pode vir com um número junto que não saberemos qual é, então fica um pouco inconveniente usar  nome do container.

Além disso, com o `docker compose`, os comandos ficam no contexto daquele `docker-compose.yml`, então, comandos como `ps` para listar os containers ativos, vão mostrar somentes os containers daquele `docker-compose.yml` específico.

